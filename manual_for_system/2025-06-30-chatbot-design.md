# チャットボット設計メモ (2025/06/30)

Next.js と React を用いて実装しているチャットボット機能の現状仕様をまとめます。

## 基本構成
- `ChatBot.tsx` でチャット本体を提供。状態管理には `useState` を利用し、会話履歴 `messages` と表示ステップ `step` を保持します。
- ステップは FAQ 選択を行う `survey` と自由入力の `free` の2段階です。
- FAQ データは `/data/faq.json` の `categories` 配列を参照し、カテゴリ・質問・回答をまとめています。

### messages
`{ from: "bot" | "user", text: string }` の形で履歴を保存し、画面上では吹き出し形式でスクロール表示します。

### survey ステップ
1. 初期状態ではカテゴリ一覧ボタンを表示し、選択されたカテゴリに応じて質問のリストを展開します。
2. 質問ボタンを押すとユーザーの質問と回答を `messages` に追加して表示します。
3. 問題が解決しない場合は `その他の質問を入力する` ボタンで `free` ステップへ遷移します。

### free ステップ
- 入力フォームに自由文を受け付け、送信時にユーザー発言として履歴に追加します。
- 返信は現在プレースホルダーの固定文で、今後は OpenAI API からの回答取得を想定しています。

## UI
- `ChatBotWidget.tsx` によりページ右下からチャットウィンドウを開閉可能です。開いた状態では上部の×ボタンで閉じられます。
- チャットボックスのサイズは `w-80 sm:w-96`、`h-96` で、`bg-white` と `shadow-lg` を使ったシンプルな見た目としています。

## データ構造
- `/data/faq.json` ではカテゴリごとに `id`, `title`, `faqs` を保持し、`faqs` 内は質問 `q` と回答 `a` のペアです。
- サーバー API との連携は未実装で、Next.js の静的読み込みでデータを展開しています。将来的には管理画面から更新できるよう拡張予定です。
